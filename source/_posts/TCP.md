---
title: TCP的三次握手四次挥手
date: 2020-05-21 00:16:48
tags: TCP
categories:
- 网络基础
---
### 为什么建立连接要三次握手？
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;如果只有一次握手，客户端发送连接请求后，没有收到服务端的应答，客户端无法判断连接是否成功。

&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;如果只有两次握手，客户端发出去的第一个连接请求由于某些原因导致延迟，当服务器端收到这个请求时，这个报文早已失效了，但是此时服务器端仍然认为这是客户端建立连接请求的第一次握手，于是客户端回应了服务端，这是第二次握手，因为只有两次握手，所以到这里就已经建立了连接，可是客户端并没有任何数据要发送，而服务端还在傻傻的等候，会造成很大的资源浪费。

&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;如果是三次握手，服务器端会等待客户端的第三次握手，如果第三次握手迟迟不来，服务器端就会释放相关资源。

&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;第三次握手是为了防止已经失效的连接请求报文段突然又传到服务端，因而产生错误。所以三次恰恰可以保证数据可靠传输，又提高了传输的效率。
### TCP建立连接三次握手
- 第一次握手：建立连接时，客户端发送一个SYN包到服务端，并包含了自己初始序列号a，之后进入SYN_SEND状态，等待服务器确认。

- 第二次握手：服务端收到这个SYN包并确认之后，会回复一个SYN包，并包含了对上一个a包的回应信息ACK，回应信息为下一个希望收到包的序号a+1，还包含了自己的初始序号b。然后服务器进入SYN_RECV状态。

- 第三次握手：客户端收到回应的SYN包后，回复一个ACK包做回应，其中包含了希望下一个收到包的序号b+1

### TCP断开连接四次挥手